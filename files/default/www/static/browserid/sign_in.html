<!DOCTYPE html>

<html>
<head>
<script src="https://login.persona.org/authentication_api.js"></script>
<script type="text/javascript" src="/jquery.js"></script>
<script type="text/javascript">
/*jslint browser: true */
/*global navigator, $ */

navigator.id.beginAuthentication(function (userid) {
    'use strict';

    $.post('/api/log', {'log': '<sign_in> userid: ' + userid});

    $.get('/api/whoami')
        .success(function (who) {
            if (userid === who) {
                $.post('/api/log', {'log': '<sign_in> already logged in ' + userid});
                navigator.id.completeAuthentication();
            } else {
                $.post('/api/log', {'log': '<sign_in> user not logged in ' + userid + ' !== ' + who });
                $.post('/api/loginasstan')
                    .success(function () {
                        $.post('/api/log', {'log': '<sign_in> logging in as stan'});
                        navigator.id.completeAuthentication();
                    });
            }
        });
});
</script>
</head>
<body>
sign_in
</body>
</html>
